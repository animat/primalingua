<% content_for :head do %>
<script type="text/javascript">
$(document).on("ready", function() {
  $("#lesson_save_options").hide();
  $("#save_lesson_select_menu").on("change", function() {
    $("#lesson_save_options").slideDown();
  });
  
  $('.snapshot_header h1').textfill({
      innerTag: "a",
	  minFontPixels: 6,
	  maxFontPixels: 32
  });
});
$(document).on("ajax:complete", '#update_section', function(evt, resp) {
    if (resp.status >= 200 && resp.status < 300 || resp.status === 304) {
      $("#lesson_save_options").slideUp();
    } else {
      alert("Sorry -- there was an error saving your changes.");
    }
  });
</script>
<% end %> 

<div id="section_head">
  <div id="teacher_section_settings_container">
    <div id="teacher_section_settings">
     <div class="table_head">
       <h1><%= @section.name %></h1>
     </div>
     <div class="table_body">
       
      <div id="section_current_lesson">
        <div class="section_info">
          <%= form_tag(update_section_lesson_teacher_path, {method: :post, authenticity_token: false, id: "update_section"}) do %>
            <p>
              <label>This section is currently on...<br />
                <%= grouped_collection_select :section, :lesson_id, Unit.all, :completed_lessons, :full_title, :id, :abbr_title, {}, {:id => "save_lesson_select_menu"}%>
              </label>
            </p>
            <div id="lesson_save_options">
              <% if current_teacher.sections.length > 1 %>
                Also update... 
                <% current_teacher.sections.each do |s| %>
                  <% if s == @section %>
                    <%= hidden_field_tag "section_ids[]", s.id %>
                  <% else %>
                    <label>
                      <%= check_box_tag "section_ids[]", s.id %>
                      <%= s.name %>
                    </label>
                  <% end %>
                <% end %>
              <% end %>
              <br />
			  <%= hidden_field_tag :return_to_section, @section.id %>
              <%= submit_tag "Save" %>
            </div>
          <% end %>
        </div>
        <div class="section_info">
          <div><%= link_to image_tag("workspace/button_planning.png"), planning_teachers_path(@section.lesson) %></div>
          <div><%= link_to image_tag("workspace/button_grading.png"), grading_teachers_path(@section.lesson, 0, @section) if current_teacher.premium and @section.students.length > 0 %></div>
          <div><%= link_to image_tag("workspace/button_in_class.png"), in_class_teachers_path(@section.lesson) %></div>
          <div><%= link_to image_tag("workspace/button_guide.png"), guide_teachers_path(@section.lesson) %></div>
        </div>
        <p>This section's class code is <em><%= @section.code %></em></p>
		<% if @section.archived_students.count > 0 %>
			<p>There <%= "is".pluralize(@section.archived_students.count) %> 
				<%= link_to archive_students_section_path @section do %>
					<%= "#{@section.archived_students.count} " %>
					<%= "student".pluralize(@section.archived_students.count) %>
					archived<% end%> 
				 in this class
			</p>
		<% end %>
      </div>

      <div> 
        <%= link_to edit_section_path(@section) do %>
          <div class="workspace_button">
            Edit class
          </div>
        <% end %>
        <%= link_to teacher_path(current_teacher) do %>
          <div class="workspace_button">
            Back
          </div>
        <% end %>
      </div>


     </div>
    </div>
  </div>
</div>
<div id="student_grid">
  <% if @section.active_students.empty? %>
    <h1>This class is empty.</h1>
    <p>Invite your students to create their own accounts using the class code <strong><%= @section.code %></strong>.</p>
  <% else %>
	
  	<div id="student_grid_nav">
		<table>
			<tr>
				<td>
					<%= link_to "&larr; previous overview".html_safe, previous_unit_overview(@section, @overview_unit) unless @overview_unit.is_first? %>
				</td>
				<td>
					<h1><%= "#{@overview_unit.full_title}"%></h1>
					<% if @overview_unit != @section.lesson.unit %>
						<%= link_to "return to this section's current unit", section_path(@section) %>
					<% end %>
				</td>
				<td>
					<%= link_to "next overview &rarr;".html_safe, next_unit_overview(@section, @overview_unit) unless @overview_unit.is_last? %>
				</td>	
			</tr>
		</table>
	</div>
    <div id="student_snapshots">
		<table>
		    <% @section.active_students.order(:last_name, :first_name).each_with_index do |s, i| %>
				<%= "<tr>".html_safe if i % 3 == 0 %>
				<td>
			    	<div class="student_snapshot">
						<%= render partial: "students/snapshot", locals: {student: s, section: @section, lesson: @section.lesson, milestones: s.milestones.in_unit(@overview_unit) }%>
			      </div>
				</td>
				<%= "</tr>".html_safe if i+1 % 3 == 0 %>
		    <% end %>
		</table>
  </div>
  <% end %>
</div>
