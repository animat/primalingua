<% content_for :page_script do %>
<script type="text/javascript">

$(function() {
	$(".question").blur(function() {
		var qid = $(this).attr("name").split("_")[1];
		var sid = <%= @student.id %>;
		var c = $(this).val();
	 	$.ajax({
	 		type: "POST",
	 		url: "<%= answers_url %>",
	 		data: {answer: {student_id: sid, question_id: qid, content: c}, authenticity_token: "<%= form_authenticity_token %>"},
	 		success: function() {
	 			alert("Saved!");
	 		},
	 		error: function() {
	 			alert("Problem saving data...");
	 		}
		});
	});
	$(".feedback_editor").hide();
	$(".drawing_save_btn").click(function() {
		/*var qid = 2;//$(this).data("question"); taken from the q_2 name
		var sid = 2;//taken from the URL
		var c = eval("d_"+qid).serialize();
		console.log("Here is the serialized thing!");
		console.log(c);
		$.ajax({
	 		type: "POST",
	 		url: "<%= answers_url %>",
	 		data: {answer: {student_id: sid, question_id: qid, content: c}, authenticity_token: "<%= form_authenticity_token %>",},
	 		success: function() {
	 			alert("Saved!");
	 		},
	 		error: function() {
	 			alert("Problem saving data...");
	 		}
		});*/
	})
	populate();
})

function populate() {
	$.getJSON("<%= student_answers_in_lesson_url(@student.id, @lesson.id) %>").success(function(data) {
		var tmp = $.parseJSON(data);
		$("#content").populate(tmp);
		loadFeedbackImages(tmp);
	}).error(function(data) {
		console.log("ERROR fetching JSON!");
	});
}
function loadFeedbackImages(d) {
	$.each(d, function(val) {
		console.log(val);
		if (val.substring(val.length-7, val.length) == "_status") {
			var tmp = d[val];
			$("#"+val.substring(0, 3)+"_image").attr("src", "/assets/workspace/"+tmp+"_button.png");
		}
	})
}

</script>
<% end %>

<%= @workbook_content.html_safe %>