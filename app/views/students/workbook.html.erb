<% content_for :page_script do %>
<script type="text/javascript">


var unitArray = [
{"num": "1", "title": "The First Language", "status": "complete"},
{"num": "2", "title": "Animal Language", "status": "complete"},
{"num": "3", "title": "Communicating without Words", "status": "active"},
{"num": "3", "title": "Derivatives and Stuff", "status": "inactive"},
{"num": "3", "title": "Test Lesson Name", "status": "inactive"},
{"num": "3", "title": "Test Lesson Name", "status": "inactive"}
];


$(function() {
	var timeline_width = $("#timeline_overlay").width();
	var number_of_lessons = unitArray.length;
	var lesson_width = timeline_width / number_of_lessons;
	for (i = 1; i <= number_of_lessons; i++) {
		var div = document.createElement('div');
		div.id = "lesson"+i;
		div.className = "timeline_lesson";
		$(div).css("width", lesson_width);
		if (unitArray[i-1].status == "complete") {
			$(div).css({
			"background-color": "#1EA62B",
			"backgroundImage": "url('/assets/workspace/timeline_break.png')"
			});
		} else if (unitArray[i-1].status == "active") {
			$(div).css({
			"background-color": "#E0CA05",
			"backgroundImage": "url('/assets/workspace/timeline_break.png')"
			});
		} else if (unitArray[i-1].status == "inactive") {
			$(div).css({
			"background-color": "none",
			"backgroundImage": "url('/assets/workspace/timeline_break.png')",
			"backgroundRepeat": "no-repeat"
			});
		} else {
			div.style.background = "red";
		}
		var number = document.createElement('img');
		number.setAttribute("src", "/assets/workspace/number(0"+i+").png");
		var header1 = document.createElement('h1');
		header1.innerHTML = "Lesson "+ i;
		var header2 = document.createElement('h2');
		header2.innerHTML = unitArray[i-1].title;
		div.appendChild(number);
		div.appendChild(header1);
		div.appendChild(header2);
		document.getElementById('timeline_lessons').appendChild(div);
	}

	$(".question").blur(function() {
		var qid = $(this).attr("name").split("_")[1];
		var sid = <%= @student.id %>;
		var c = $(this).val();
	 	$.ajax({
	 		type: "POST",
	 		url: "<%= answers_url %>",
	 		data: {answer: {student_id: sid, question_id: qid, content: c}, authenticity_token: "<%= form_authenticity_token %>"},
	 		success: function() {
	 			alert("Saved!");
	 		},
	 		error: function() {
	 			alert("Problem saving data...");
	 		}
		});
	});
	$(".feedback_editor").hide();
	$(".drawing_save_btn").click(function() {
		/*var qid = 2;//$(this).data("question"); taken from the q_2 name
		var sid = 2;//taken from the URL
		var c = eval("d_"+qid).serialize();
		console.log("Here is the serialized thing!");
		console.log(c);
		$.ajax({
	 		type: "POST",
	 		url: "<%= answers_url %>",
	 		data: {answer: {student_id: sid, question_id: qid, content: c}, authenticity_token: "<%= form_authenticity_token %>",},
	 		success: function() {
	 			alert("Saved!");
	 		},
	 		error: function() {
	 			alert("Problem saving data...");
	 		}
		});*/
	})
	populate();
})

function populate() {
	$.getJSON("<%= student_answers_in_lesson_url(@student.id, @lesson.id) %>").success(function(data) {
		var tmp = $.parseJSON(data);
		$("#content").populate(tmp);
		loadFeedbackImages(tmp);
	}).error(function(data) {
		console.log("ERROR fetching JSON!");
	});
}
function loadFeedbackImages(d) {
	$.each(d, function(val) {
		console.log(val);
		if (val.substring(val.length-7, val.length) == "_status") {
			var tmp = d[val];
			$("#"+val.substring(0, 3)+"_image").attr("src", "/assets/workspace/"+tmp+"_button.png");
		}
	})
}

</script>
<% end %>

<%= @workbook_content.html_safe %>